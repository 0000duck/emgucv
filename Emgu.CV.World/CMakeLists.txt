# --------------------------------------------------------
#  Copyright (C) 2004-2015 by EMGU Corporation. All rights reserved.
# --------------------------------------------------------

IF(EMGU_CV_BUILD OR EMGU_CV_EXAMPLE_BUILD)

PROJECT(Emgu.CV.World)

IF(ANDROID)
ELSEIF(IOS)
BUILD_CSPROJ(${PROJECT_NAME} "${CMAKE_CURRENT_SOURCE_DIR}/Emgu.CV.World.IOS.csproj")
INSTALL(
  FILES 
  ${LIBRARY_OUTPUT_PATH}/${PROJECT_NAME}.xml
  ${LIBRARY_OUTPUT_PATH}/${PROJECT_NAME}.dll 
  DESTINATION ${CPACK_PACKAGE_CLI_FOLDER}
  COMPONENT emgucv_binary)
ELSEIF(NETFX_CORE)
#ELSE(WIN32)
#BUILD_CSPROJ(${PROJECT_NAME} "${CMAKE_CURRENT_SOURCE_DIR}/Emgu.CV.World.csproj")
#INSTALL(
#  FILES 
#  ${LIBRARY_OUTPUT_PATH}/${PROJECT_NAME}.xml
#  ${LIBRARY_OUTPUT_PATH}/${PROJECT_NAME}.dll 
#  DESTINATION ${CPACK_PACKAGE_CLI_FOLDER}
#  COMPONENT emgucv_binary)
#if(ENABLE_SOLUTION_FOLDERS)
#    set_target_properties(${PROJECT_NAME} PROPERTIES FOLDER "emgu")
#endif()
#ADD_DEPENDENCIES(${PROJECT_NAME} cvextern)
ELSE()

SET(SRC_EMGU_CV_WORLD)
FILE(GLOB_RECURSE SRC_EMGU_UTIL RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} "../Emgu.Util/*.cs")
LIST(APPEND SRC_EMGU_CV_WORLD ${SRC_EMGU_UTIL})

FILE(GLOB_RECURSE SRC_EMGU_CV RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} "../Emgu.CV/*.cs")
FILE(GLOB_RECURSE SRC_EMGU_CV_EXCLUDES RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} "../Emgu.CV/PInvoke/Unity/*.cs" "../Emgu.CV/PInvoke/iOS/libemgucv.linkwith.cs")
LIST(REMOVE_ITEM SRC_EMGU_CV ${SRC_EMGU_CV_EXCLUDES})
LIST(APPEND SRC_EMGU_CV_WORLD ${SRC_EMGU_CV})

FILE(GLOB_RECURSE SRC_EMGU_CV_ML RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} "../Emgu.CV.ML/*.cs")
LIST(APPEND SRC_EMGU_CV_WORLD ${SRC_EMGU_CV_ML})

FILE(GLOB_RECURSE SRC_EMGU_CV_VIDEOSTAB RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} "../Emgu.CV.VideoStab/*.cs")
LIST(APPEND SRC_EMGU_CV_WORLD ${SRC_EMGU_CV_VIDEOSTAB})

FILE(GLOB_RECURSE SRC_EMGU_CV_SUPERRES RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} "../Emgu.CV.Superres/*.cs")
LIST(APPEND SRC_EMGU_CV_WORLD ${SRC_EMGU_CV_SUPERRES})

FILE(GLOB_RECURSE SRC_EMGU_CV_STITCHING RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} "../Emgu.CV.Stitching/*.cs")
LIST(APPEND SRC_EMGU_CV_WORLD ${SRC_EMGU_CV_STITCHING})

FILE(GLOB_RECURSE SRC_EMGU_CV_SHAPE RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} "../Emgu.CV.Shape/*.cs")
LIST(APPEND SRC_EMGU_CV_WORLD ${SRC_EMGU_CV_SHAPE})

IF (EMGU_CV_WITH_TESSERACT)
FILE(GLOB_RECURSE SRC_EMGU_CV_OCR RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} "../Emgu.CV.OCR/*.cs")
LIST(APPEND SRC_EMGU_CV_WORLD ${SRC_EMGU_CV_OCR})
ENDIF()

FILE(GLOB_RECURSE SRC_EMGU_CV_CUDA RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} "../Emgu.CV.Cuda/*.cs")
LIST(APPEND SRC_EMGU_CV_WORLD ${SRC_EMGU_CV_CUDA})

FILE(GLOB_RECURSE SRC_EMGU_CV_CONTRIB RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} "../Emgu.CV.Contrib/*.cs")
LIST(APPEND SRC_EMGU_CV_WORLD ${SRC_EMGU_CV_CONTRIB})

LIST(APPEND SRC_EMGU_CV_WORLD ${CMAKE_CURRENT_SOURCE_DIR}/../CommonAssemblyInfo.cs)
LIST(APPEND SRC_EMGU_CV_WORLD ${CMAKE_CURRENT_SOURCE_DIR}/Properties/AssemblyInfo.cs)
GENERATE_DOCUMENT(${LIBRARY_OUTPUT_PATH}/${PROJECT_NAME})
SIGN_ASSEMBLY(${CMAKE_CURRENT_SOURCE_DIR}/../Emgu.CV.snk)
SET_CS_TARGET_FRAMEWORK(${CSC_TARGET_FRAMEWORK})
COMPILE_CS(${PROJECT_NAME} "library" "${SRC_EMGU_CV_WORLD}" ALL)

ADD_DEPENDENCIES(${PROJECT_NAME} cvextern)

INSTALL(
  FILES 
  ${LIBRARY_OUTPUT_PATH}/${PROJECT_NAME}.xml
  ${LIBRARY_OUTPUT_PATH}/${PROJECT_NAME}.dll 
  DESTINATION ${CPACK_PACKAGE_CLI_FOLDER}
  COMPONENT emgucv_binary)
if(ENABLE_SOLUTION_FOLDERS)
    set_target_properties(${PROJECT_NAME} PROPERTIES FOLDER "emgu")
endif()
ENDIF()
  
IF(WIN32 OR APPLE OR ANDROID)
IF(NETFX_CORE OR ANDROID)
INSTALL(
  DIRECTORY
  ${CMAKE_CURRENT_SOURCE_DIR}
  DESTINATION .
    COMPONENT emgucv_source
  FILES_MATCHING 
	PATTERN "*.shproj"
	PATTERN "*.projitems"
	PATTERN "*.cs"
    PATTERN "*.resx"
    PATTERN ".svn" EXCLUDE
    PATTERN "obj" EXCLUDE
    PATTERN "CMakeFiles" EXCLUDE
    PATTERN "${PROJECT_NAME}.dir" EXCLUDE
    )
ELSE()
INSTALL(
  DIRECTORY
  ${CMAKE_CURRENT_SOURCE_DIR}
  DESTINATION .
    COMPONENT emgucv_source
  FILES_MATCHING 
    PATTERN "${PROJECT_NAME}.csproj"
    PATTERN "AssemblyInfo.cs"
    PATTERN ".svn" EXCLUDE
    PATTERN "obj" EXCLUDE
    PATTERN "CMakeFiles" EXCLUDE
    PATTERN "${PROJECT_NAME}.dir" EXCLUDE
)
ENDIF()

ENDIF()  

ENDIF()
